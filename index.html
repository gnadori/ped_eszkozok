<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Óraelemző v3</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a73e8; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 40px; }
        .section { margin-bottom: 15px; padding: 15px; border-radius: 8px; background: #fff; border: 1px solid #e0e0e0; }
        .section h3 { margin-top: 0; color: #1a73e8; border-bottom: 2px solid #f0f2f5; padding-bottom: 8px; font-size: 1.05em; }
        .question { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 0.9em; line-height: 1.4; }
        select { padding: 5px; border-radius: 4px; border: 1px solid #ccc; background: #fff; cursor: pointer; width: 80px; }
        select.yes { background-color: #e6ffed; border-color: #2ecc71; }
        .chart-container { position: sticky; top: 20px; text-align: center; }
        .header-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .header-info input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 90%; }
        
        .export-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 30px; }
        .btn { padding: 12px 25px; border-radius: 6px; cursor: pointer; font-weight: bold; border: none; transition: 0.2s; color: white; }
        .btn-pdf { background: #1a73e8; }
        .btn-csv { background: #27ae60; }
        .btn:hover { opacity: 0.8; }

        @media (max-width: 850px) { .grid { grid-template-columns: 1fr; } .chart-container { position: static; } }
        @media print { .export-buttons { display: none; } .container { box-shadow: none; border: none; } }
    </style>
</head>
<body>

<div class="container">
    <h1>Óraelemző</h1>
    
    <div class="header-info">
        <input type="text" id="tanar" placeholder="Tanár neve">
        <input type="text" id="targy" placeholder="Tantárgy">
        <input type="text" id="osztaly" placeholder="Osztály">
        <input type="text" id="tema" placeholder="Téma">
    </div>

    <div class="grid">
        <div id="questions-area">
            <div class="section" data-cat="0">
                <h3>1. Tervezés és készülés</h3>
                <div class="question"><span>Van megfogalmazott pedagógiai célja?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Kapcsolódik nagyobb tervhez?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Volt előzetes tudásmérés?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Mérték a diákok motivációját?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>

            <div class="section" data-cat="1">
                <h3>2. Tevékenységek</h3>
                <div class="question"><span>Volt-e nem frontális munkaforma?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>A tanár kevesebbet beszélt?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Volt lehetőség egyéni kutatásra?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>

            <div class="section" data-cat="2">
                <h3>3. Kommunikáció és kollaboráció</h3>
                <div class="question"><span>Beszélhettek a diákok egymással?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Volt pár- vagy csoportmunka?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Elengedhetetlen volt a kollaboráció?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Hozhattak a diákok közös döntést?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>

            <div class="section" data-cat="3">
                <h3>4. Tudásépítés</h3>
                <div class="question"><span>Kellett értelmezni, kritikusan gondolkodni?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Kellett összefüggéseket keresni?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Vitázhattak a diákok?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>

            <div class="section" data-cat="4">
                <h3>5. Differenciálás</h3>
                <div class="question"><span>Nem mindenki ugyanazt csinálta?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Többféle megközelítést használt?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Épített az egyéni erősségekre?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>

            <div class="section" data-cat="5">
                <h3>6. Relevancia, érthetőség</h3>
                <div class="question"><span>Életközeli problémák jelentek meg?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Érthető volt a nyelvezet?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Kaptak segítséget a kifejezésekhez?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>

            <div class="section" data-cat="6">
                <h3>7. Alapkompetenciák</h3>
                <div class="question"><span>Fejlődött a szövegértésük?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Használtak digitális eszközöket?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Fejlődött a szociális készségük?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>

            <div class="section" data-cat="7">
                <h3>8. Értékelés, visszajelzés</h3>
                <div class="question"><span>Kaptak a diákok visszajelzést?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Volt sikerélményük a diákoknak?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
                <div class="question"><span>Elérte az óra a céljait?</span> <select onchange="updateChart(this)"><option value="0">Nem</option><option value="1">Igen</option></select></div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="radarChart"></canvas>
            <div class="export-buttons">
                <button class="btn btn-pdf" onclick="window.print()">Letöltés PDF-ként</button>
                <button class="btn btn-csv" onclick="downloadCSV()">Letöltés CSV-ként</button>
            </div>
        </div>
    </div>
</div>

<script>
    const ctx = document.getElementById('radarChart').getContext('2d');
    const labels = ['Tervezés', 'Tevékenységek', 'Kommunikáció', 'Tudásépítés', 'Differenciálás', 'Relevancia', 'Kompetenciák', 'Értékelés'];

    let myChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: labels,
            datasets: [{
                data: [0, 0, 0, 0, 0, 0, 0, 0],
                backgroundColor: 'rgba(26, 115, 232, 0.2)',
                borderColor: 'rgba(26, 115, 232, 1)',
                borderWidth: 3,
                pointBackgroundColor: 'rgba(26, 115, 232, 1)'
            }]
        },
        options: {
            scales: { r: { min: 0, max: 100, ticks: { display: false } } },
            plugins: { legend: { display: false } }
        }
    });

    function updateChart(el) {
        if(el) el.className = el.value == "1" ? "yes" : "";
        const scores = [];
        for (let i = 0; i < 8; i++) {
            const selects = document.querySelectorAll(`.section[data-cat="${i}"] select`);
            let yesCount = 0;
            selects.forEach(s => { if(s.value == "1") yesCount++; });
            scores.push(Math.round((yesCount / selects.length) * 100));
        }
        myChart.data.datasets[0].data = scores;
        myChart.update();
    }

    function downloadCSV() {
        let csvContent = "\uFEFF"; // Magyar karakterek támogatása Excelben
        
        // Alapadatok
        csvContent += "ÓRAELEMZÉSI JEGYZŐKÖNYV\n";
        csvContent += `Tanár;${document.getElementById('tanar').value}\n`;
        csvContent += `Tantárgy;${document.getElementById('targy').value}\n`;
        csvContent += `Osztály;${document.getElementById('osztaly').value}\n`;
        csvContent += `Téma;${document.getElementById('tema').value}\n\n`;
        
        // Részletes válaszok
        csvContent += "RÉSZLETES VÁLASZOK\n";
        csvContent += "Kategória;Kérdés;Válasz\n";
        
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => {
            const catTitle = section.querySelector('h3').innerText;
            const questions = section.querySelectorAll('.question');
            questions.forEach(q => {
                const qText = q.querySelector('span').innerText;
                const qAns = q.querySelector('select').value == "1" ? "Igen" : "Nem";
                csvContent += `"${catTitle}";"${qText}";"${qAns}"\n`;
            });
        });

        // Összesítés
        csvContent += "\nÖSSZESÍTETT EREDMÉNYEK (0-100)\n";
        csvContent += "Kategória;Érték\n";
        const scores = myChart.data.datasets[0].data;
        labels.forEach((label, index) => {
            csvContent += `${label};${scores[index]}\n`;
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.setAttribute("href", URL.createObjectURL(blob));
        link.setAttribute("download", "oraelemzes_reszletes.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    updateChart();
</script>

</body>
</html>
